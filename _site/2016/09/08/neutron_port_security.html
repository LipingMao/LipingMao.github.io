<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Neutron Memo - Port Security</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  </head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title--small">
    <a href="/">Liping Mao</a>
  </h1>
</header>      
<div class="content post">
  <h1 class="post-title">Neutron Memo - Port Security</h1>
  <div class="post-date">
    <time>08 Sep 2016</time>
  </div>
  <h2 id="backgroup">Backgroup</h2>

<blockquote>
  <p>Neutron has anti-ip-spoofing feature by default. User can use allowed-address-pairs to disable this. Neutron also support to disable it completely, here it is : Port-Security.</p>
</blockquote>

<h2 id="basic-usage">Basic Usage</h2>

<blockquote>
  <p>Here is a sample which help you setup/use port-security.</p>
</blockquote>

<h4 id="how-to-enable-port-security-feature">How to enable port-security feature</h4>

<blockquote>
  <p>Here is how to enable port-security in ml2 extension drivers.</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code># Add the below line in /etc/neutron/plugins/ml2/ml2_conf.ini
# and restart neutron-server.
extension_drivers = port_security
</code></pre>
</div>

<h4 id="how-to-use-port-security">How to use port-security</h4>

<blockquote>
  <p>port-security can be disable in Network or Port.</p>
</blockquote>

<p>Create network with port-security false:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># neutron net-create  --port_security_enabled=false private_test
# neutron net-show e6c81b80-3dc9-4515-9123-0d17cefd22dc
+-------------------------+--------------------------------------+
| Field                   | Value                                |
+-------------------------+--------------------------------------+
| admin_state_up          | True                                 |
| availability_zone_hints |                                      |
| availability_zones      | nova                                 |
| created_at              | 2016-09-07T07:28:50                  |
| description             |                                      |
| id                      | e6c81b80-3dc9-4515-9123-0d17cefd22dc |
| ipv4_address_scope      |                                      |
| ipv6_address_scope      |                                      |
| mtu                     | 1450                                 |
| name                    | private_test                         |
| port_security_enabled   | False                                |
| qos_policy_id           |                                      |
| router:external         | False                                |
| shared                  | False                                |
| status                  | ACTIVE                               |
| subnets                 | 0e12f67a-962a-4737-85d3-e6b17b63ccc8 |
| tags                    |                                      |
| tenant_id               | 5e336f24f89c43f5ab4d1dd07f54b86d     |
| updated_at              | 2016-09-07T07:28:50                  |
+-------------------------+--------------------------------------+
</code></pre>
</div>

<p>You must boot vm without security-group, then IN and OUT of ipstables rules of the VM will be similiar like following, It will be ACCEPT for all traffic, for sure, you will not go into spoofing iptables chain here:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Chain neutron-openvswi-FORWARD (1 references)
 pkts bytes target     prot opt in     out     source               destination         
 2900  323K neutron-openvswi-scope  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
   13  2006 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-out tapa45e21f7-86 --physdev-is-bridged /* Accept all packets when port security is disabled. */
   11  1212 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            PHYSDEV match --physdev-in tapa45e21f7-86 --physdev-is-bridged /* Accept all packets when port security is disabled. */
</code></pre>
</div>

<p>You can also disable port-security in port level, when you disable it, you also need remove security-groups on that port:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># neutron port-update --port_security_enabled=false --no-security-groups a45e21f7-8654-495f-b3b9-ea42d73778b4
# neutron port-show a45e21f7-8654-495f-b3b9-ea42d73778b4
+-----------------------+----------------------------------------------------------------------------------------+
| Field                 | Value                                                                                  |
+-----------------------+----------------------------------------------------------------------------------------+
| admin_state_up        | True                                                                                   |
| allowed_address_pairs |                                                                                        |
| binding:vnic_type     | normal                                                                                 |
| created_at            | 2016-09-07T05:49:39                                                                    |
| description           |                                                                                        |
| device_id             | 7a03c4fd-653d-4fc6-a32e-e62f40a38bcd                                                   |
| device_owner          | compute:nova                                                                           |
| dns_name              |                                                                                        |
| extra_dhcp_opts       |                                                                                        |
| fixed_ips             | {"subnet_id": "b8da86ab-6736-4c2c-8989-83d2c7a502f6", "ip_address": "200.200.200.109"} |
| id                    | a45e21f7-8654-495f-b3b9-ea42d73778b4                                                   |
| mac_address           | fa:16:3e:a9:ee:4b                                                                      |
| name                  |                                                                                        |
| network_id            | f0c38656-ac54-483c-b19b-1d2ffde481ed                                                   |
| port_security_enabled | False                                                                                  |
| qos_policy_id         |                                                                                        |
| security_groups       |                                                                                        |
| status                | ACTIVE                                                                                 |
| tenant_id             | 5e336f24f89c43f5ab4d1dd07f54b86d                                                       |
| updated_at            | 2016-09-07T07:02:15                                                                    |
+-----------------------+----------------------------------------------------------------------------------------+
</code></pre>
</div>

<h2 id="refer">Refer</h2>
<p><a href="https://specs.openstack.org/openstack/neutron-specs/specs/kilo/ml2-ovs-portsecurity.html">Neutron Kilo Spec for port-security</a></p>

</div>

  </div>
</body>
</html>
