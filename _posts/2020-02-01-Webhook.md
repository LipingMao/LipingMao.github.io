---
title: DevOps -- Webhook Service in  Zego
---

> 服务器端当发生一些异步动作的时候，往往需要使用Webhook进行回调。目前我们的使用场景中，服务器端有一些Restful API不能提供同步调用返回（如录制文件是异步生成的），这种情况下就需要用户配置一个回调地址，事件回调回去。本文大概对比了声网和即构目前的回调机制





## 回调配置

以下是声网处理/配置服务器端回调的基本方式:

你需要联系 sales@agora.io 开通消息通知服务，并提供以下配置信息：

1. 接收消息通知的 HTTP/HTTPS 服务器地址。

2. 你想使用通知服务的[业务](https://docs-preview.agoralab.co/cn/Agora Platform/ncs?platform=All Platforms#pro)。

3. 你想得到通知的[事件](https://docs-preview.agoralab.co/cn/Agora Platform/ncs?platform=All Platforms#event)。

4. 选择是否开启消息通知

   重试

   。消息通知服务是实时通知，开启通知重试后，消息通知服务器就会在第一次通知失败后立即重试，再次发送消息通知，最多会尝试三次通知。消息通知服务器在以下任意一种情况下会认为通知失败：

   - 发送消息通知后，10 秒内没有收到你的服务器的响应。
   - 收到你的服务器响应的 HTTP 状态码不是 200。



配置消息通知服务后，你需要注意以下事项：

- 5 分钟后，该服务即会生效。你的服务器需要尽快响应消息通知服务器，响应的 body 格式必须为 JSON。
- 我们系统将自动生成 `secret`。`secret` 是字符串类型的密钥，密钥可以用来生成签名，你需要保存这个密钥以备后续验签，详见[验证签名](https://docs-preview.agoralab.co/cn/Agora Platform/ncs?platform=All Platforms#signature)。



可以看到声网并没有提供用户自助配置接口，而是需要联系销售。用户体验并不是很好。



而即构，大概是以下方式配置：

在APP的配置中，有高级配置，可以指定对应event的回调接口：

![image-20200213215658689](/Users/limao/Library/Application Support/typora-user-images/image-20200213215658689.png)



相对来说，即构提供了URL自助配置。但是即构在每一种Event要单独配置URL，这种体验对于用户来说也不是很好，而且即构的Event类型并没有一致的格式。这点上声网比即构要做的好一些。



## 回调重试

对于回调的Event，需要有一些重试机制保证消息尽量到达：

声网

选择是否开启消息通知**重试**。消息通知服务是实时通知，开启通知重试后，消息通知服务器就会在第一次通知失败后立即重试，再次发送消息通知，最多会尝试三次通知。消息通知服务器在以下任意一种情况下会认为通知失败：

- 发送消息通知后，10 秒内没有收到你的服务器的响应。
- 收到你的服务器响应的 HTTP 状态码不是 200。

注意：

- 你的服务器收到的通知顺序和事件发生的顺序不一定完全一致。
- 为确保消息通知的可靠性，每次事件可能会有不止一次消息通知，你的服务器需要能处理重复消息。
- 如果需要配置 QPS（Query Per Second）比较高的事件，如实时通信业务中的 105 或 106 事件，请确保你的服务器有足够的处理能力。



而即构则是若请求回调地址失败，ZEGO服务器会在5秒后发起一次重试，重试仍然失败后，将不再继续重试。

相对来说声网做的更加细致一些。



## 回调鉴权

对于声网和即构都使用单独的Key，一个是对body加密，另一个则是生成了sign。 没有太大区别，可能声网加密body的方式，在http情况下更加安全一些。





## 总结

1. 支持用户自助配置

2. 使用统一Event形式，配置一个URL

3. 回调重试与声网类似

4. 回调函数使用app 密钥进行鉴权，不另外添加一个密码

   