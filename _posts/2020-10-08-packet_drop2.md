---
title: DevOps -- packet drop 2
---

### MTU

MTU是一个比较容易让人忽略的丢包点，比如：
虚拟化环境中的overlay网络（GRE，vxlan等），会导致增加额外包头，如果接口MTU没有调整，在增加包头后会超过默认MTU限制，从而导致丢包。

VPN隧道也是常见的问题，比如在云上自建IPSec隧道，就需要修改MTU，以保证不会超过MTU而需要进行IP分片，有写情况下上层是会设置IP层DF的。


### 物理接口队列

高并发场景下，Interface的队列个数/长度也往往会导致丢包。例如：
思科UCS默认情况下，网卡收包队列4个/发包队列为1个，队列长度为256。这样的配置，在50-100kpps的情况下就有可能会丢包（当然这也和出队处理速度有关）。通常可以改为8-16个队列，2048的队列长度。

其他物理网卡也有类似配置，通常可以使用ethtool -S查看网卡统计信息，相应调整。


### 虚拟接口队列

如果使用了虚拟接口，例如eth pair等，每个虚拟设备也有队列长度，默认是500。这个值可以调整到默认10000 。


### 虚拟交换机

如果使用了虚拟交换机，例如OVS，在OVS上也是容易产生丢包的点。例如：
1） OVS CAM（MAC地址表）过多。
2） OVS 流表的一些限制，比如单个流规则action长度（如果action与节点数目正比，action会因为长度过长溢出）
3） OVS 有些场景会failback到slow path，在用户态处理会耗费更多CPU，而CPU高后是容易产生丢包的。



