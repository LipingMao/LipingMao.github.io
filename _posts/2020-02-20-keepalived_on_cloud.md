---
title: DevOps -- HAVIP failover slow on tencent cloud
---

> 在腾讯云上海环境发现HAVIP迁移有时需要几秒（正常速度），有时需要1分钟左右。

Debug发现，我们使用Keepalived做VIP的漂移，发生问题时，vip已经迁移到新的主机，但是在VIP迁移到新主机后，其他主机一段时间无法ping通这个vip，过了一段时间后才能ping通。

和腾讯云研发debug后发现，这是腾讯云的一个路由下发性能问题。
云厂商底层都是使用overlay网络，每次HAVIP的变化，都会引起路由变化。底层应该是通过获取RARP信息，判断HAVIP发生了迁移，之后进行HAVIP的路由变更。

问题是，VPC本身路由变更在某些场景下会碰到性能问题：
1） 如果AZ非常大，VPC非常多时。
2） 如果我们所在母机，和某些大客户所在母机相同时（他们变动比较频繁）

会产生路由变更的瓶颈。目前看来最多可能会1分钟左右路由下发成功。

目前解决这个问题的Workaround是：
1） 使用CDH，你有独立的母机
2） 使用腾讯云提供的数据库产品（就不需要havip了）

或者腾讯云计划3个月后上优化VPC下发速度的版本。


PS：
有些问题只有深入使用后才会碰到，😅
